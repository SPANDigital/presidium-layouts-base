{{/*
Checks if the current page/content is from an imported content module.
Returns: dict with isImported and githubUrl
Usage: {{ $result := partial "common/is-imported" . }}
*/}}
{{- $result := dict "isImported" false "githubUrl" "" -}}
{{- with .File -}}
    {{- $filename := .Filename -}}
    {{- range $index, $element := hugo.Deps -}}
        {{- if in $filename $element.Path -}}
            {{- $result = dict "isImported" true "githubUrl" "" -}}
            {{- if strings.Contains $element.Path "github" -}}
                {{/* Split module path by "/" to extract host, owner, repo */}}
                {{- $moduleParts := split $element.Path "/" -}}
                {{- if ge (len $moduleParts) 3 -}}
                    {{- $host := index $moduleParts 0 -}}
                    {{- $owner := index $moduleParts 1 -}}
                    {{- $repo := index $moduleParts 2 -}}
                    {{- $ref := cond (ne $element.Version "") $element.Version "HEAD" -}}

                    {{/* Extract relative path by splitting filename on module path */}}
                    {{- $filePathParts := split $filename $element.Path -}}
                    {{- if ge (len $filePathParts) 2 -}}
                        {{- $relativePath := index $filePathParts 1 -}}
                        {{- $relativePath = strings.TrimPrefix "/" $relativePath -}}
                        {{- $githubUrl := printf "https://%s/%s/%s/blob/%s/%s" $host $owner $repo $ref $relativePath -}}
                        {{- $result = dict "isImported" true "githubUrl" $githubUrl -}}
                    {{- end -}}
                {{- end -}}
            {{- end -}}
        {{- end -}}
    {{- end -}}
{{- end -}}
{{- return $result -}}