{{/*
Atomic article renderer - handles individual article display without recursion.
Optimized for performance with minimal DOM manipulation and efficient conditional rendering.
*/}}

{{- $params := .Params -}}
{{- $roles := $params.roles | default "All Roles" -}}
{{- $slug := (partial "common/slug" .) -}}
{{- $nestedArticles := .Site.Params.includeNestedArticles | default true -}}

{{/* Pre-compute article metadata for performance */}}
{{- $articleLink := (printf "%v#%v" .Parent.Page.RelPermalink $slug) -}}
{{- $.Scratch.Set "articleLink" $articleLink -}}

{{- $hasDataPages := .Data.Pages -}}
{{- $type := cond (not $hasDataPages) "child" "parent" -}}

{{/* File-based article identification with null safety */}}
{{- $file := .File -}}
{{- if $file -}}
    {{- $articleId := ($params.id | default $file.Path) -}}
    {{- $contentLength := len .Content -}}
    {{- $noContent := eq $contentLength 0 -}}
    {{- $uid := $file.UniqueID -}}

    {{/* Optimized conditional rendering - check content existence efficiently */}}
    {{- $shouldRenderWrapper := or (ne $contentLength 0) (and $nestedArticles (partial "common/pages" .)) -}}

    <div class="article {{ $type }}"
         data-roles="{{ $roles }}"
         id="{{ $uid }}"
         data-link="{{ $articleLink }}"
         permalink="{{ .Page.RelPermalink }}"
         data-no-content="{{ $noContent }}"
         title="{{ .Title }}">

        {{- if $shouldRenderWrapper -}}
            <div class="presidium-article-wrapper">
                <span class="anchor" id="{{ $slug }}" data-id="{{ $articleId }}"></span>

                {{/* Batch render all article components for optimal performance */}}
                {{- partial "article/validation" . -}}
                {{- partial "article/header" . -}}
                {{- partial "article/title" . -}}
                {{- partial "article/frontmatter" . -}}
                {{- partial "article/content" . -}}
                {{- partial "article/footer" . -}}
            </div>
        {{- end -}}
    </div>
{{- else -}}
    {{/* Graceful degradation for pages without file context */}}
    <div class="article {{ $type }}" data-roles="{{ $roles }}" title="{{ .Title }}">
        <!-- Article without file context -->
    </div>
{{- end -}}